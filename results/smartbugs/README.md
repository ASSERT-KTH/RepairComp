# APR on Smartbugs-curated overview

Each contract is labeled with only one category. For more details, refer to the file _contracts.csv_

## Directory Structure

The directory structure of the project is as follows:

- `Tool Name`: Directory contains the results for the execution of the tool given by the directory's name.
    + `Smartbugs-curated type`:
        - `contract_file_name`: directory with results for the respective contract.
            - `contract_file_name.sol`*: Solidity patch generated by the respective tool.
            - `contract_file_name.bin`: Bytecode code of the patch generated by the respective tool.
            - `other`: other metadata and outputs from the tool.
        - `return_codes.csv`:  return codes of each contract execution for th respective tool.
        - `patches_diff.csv`: comparisons between the patches and their original contract files.
        - `compilation_results_VERSION.csv`: pacthes with their respective compilability with the solidity VERSION. Only available for solidity patches.
        - `valid_patches.csv`: pacthes that are compilable and different from their original contract.
        - `patches_with_bugs.csv`: patches with bugs, vulnerability reports and the original contract vulnerability reports.
        - `patches_without_bugs.csv`: patches without bugs, vulnerability reports and the original contract vulnerability reports.

- `contracts.csv`: This file contains more details about each contract, including their labels.

*If the tool generates multiple patches for each contract file, then the patches naming convention is given by the tool itself. Each patch is prefixed by the `contract_file_name` and suffixed by their respective extension (`.sol` if source code, `.bin` if bytecode).


## Execution of the APR tools
|Tool\Return code                    |0 (success)|1 (errors)|timeout (4hr)|134(heap out of memory)|139 (segfault: core dump)|251 (compilation)|253|Notes                                                             |
|------------------------------------|-----------|----------|---------------|-----------------------|-------------------------|-----------------|---|------------------------------------------------------------------|
|[Elysium](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/Elysium/return_codes.csv)  (binary)                           |126        |15        |0              |0                      |0                        |1                |1  |1: run_oyente breaks, only mythril is used for these cases in eval|
|[Smartshield](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SmartShield/return_codes.csv)   (binary)                       |134        |9         |0              |0                      |0                        |0                |0  |1: code errors                                                    |
|[sGuard](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/sGuard/return_codes.csv)                              |132        |1         |2              |8                      |0                        |0                |0  |                                                                  |
|[sGuardPlus](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/sGuardPlus/return_codes.csv)                          |111        |33        |0              |0                      |0                        |0                |0  |Exceptions in revert2src.js                                       |
|[SmartFix](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SmartFix/return_codes.csv)                            |135        |8         |0              |0                      |0                        |0                |0  |                                                                  |
|Aroc                                |135        |0         |0              |0                      |8                        |0                |0  |                                                                  |
|[TIPS](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/TIPS/return_codes.csv)                                |140        |3         |0              |0                      |0                        |0                |0  |1: code errors in parsing json objects                            |
|[SolGPT](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SolGPT/patches_per_contract.csv)                              |139        |4         |0              |0                      |0                        |0                |0  |1: openai or slither                            |

## Vulnerabilities detected by the APR tools
| Tool                  | contract files w/ vuln | total vulnerabilities | 
|-----------------------|------------------------|-----------------------|
| **Smartbugs-curated** |                    143 |                   207 |
| Elysium (binary)      |                    102 |                   217 |
| Smartshield (binary)  |                     72 |                   121 |
| sGuard                |                     62 |                   428 |
| sGuardPlus            |                    112 |                   195 |
| SmartFix              |                     89 |                   476 |
| TIPS                  |                     90 |                   100 |
| [SolGPT](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SolGPT/vulns_Medium.csv)                |                    112 |                   318 |


## Patches overview in smartbugs-curated (patches)

```
find sGuard -name "*.sol" | wc
find sGuardPlus/ -name "*.sol" | wc
find Smart -name "*.sol" | wc
find SmartFix/ -name "*.sol" | wc
find TIPS/ -name "*.sol" | wc
ls SmartFix/*/*/*sol | wc
find SolGPT/ -name "*round.sol" | wc

find Elysium/ -name "*.bin" | wc
find SmartShield/ -name "*.bin" | wc
```

| Tool                  | #outputs | #diff patches | compilable | patches w/o bugs | patches w/ bugs | paches w/ new bugs (detector+manual check) | og contracts w/o bugs |
|-----------------------|----------|---------------|------------|------------------|-----------------|--------------------|-----------------------|
| Elysium (binary)      |      126 |            101|           -|                98|                3|                  2+|                     98|
| Smartshield (binary)  |      134 |            131|           -|               108|               23|                    |                    108|
| sGuard                |      109 |             62|         109|                 2|               56|                    |                      2|
| sGuardPlus            |       81 |             81|          81|                71|               10|                  10|                     71|
| SmartFix              |       86 |             86|          86|                66|               20|                   1|                     66|
| TIPS                  |      242 |            242|         234|               177|               57|                    |                    132|
| SolGPT                |      552 |            552|         527|               251|              276|                    |                     70|




# Per Contract Overview
This table collects the information per contract in the dataset. For tools that generate multiple patches(SolGPT &TIPS) we count if at least 1 patch fulfills the category.
total contracts in the repository: 143
1 duplicate ()

| Tool                  | #generation | compilable | #diff patches | valid patches (Comp&Diff) |
|-----------------------|----------|---------------|------------|------------------|
| Elysium (binary)      |      126 |            N/A|         101|               TBA|  
| sGuard                |      109 |            108|          62|               TBA| 
| sGuardPlus            |       81 |             81|          81|               TBA| 
| SmartFix              |       86 |             86|          86|               TBA| 
| Smartshield (binary)  |      134 |            N/A|         131|               TBA|  
| SolGPT                |      139 |            138|         139|               TBA| 
| TIPS                  |      140 |            138|         140|               TBA| 


